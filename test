@Library('StudySharedLib')_
pipeline{
  agent any
  environment {
    DEPLOY_ENV = 'staging'
    GIT_REPO_URL = 'https://github.com/LaDebz/maven-web-app.git'
  }
  toools {
    maven 'maven3.9.4'
  }
  stages {
    stage('Clone from Github'){
      steps{
        git "${GIT_REPO_URL}"
      }
    }
    stage('Build with Maven'){
      steps{
        study("Build")
      }
    }
    stage('Test with Sonar'){
      steps{
        study("Test")
      }
    }
    stage('Deploy to Nexus'){
      steps{
        study("Deploy")
      }
    }
    stage('Deployment stage'){
      steps{
        script {
          if (env.DEPLOY_ENV == 'staging'){
          deploy adapters: [tomcat9(credentialsId: 'Tomcat_Cred', path: '', url: 'http://18.216.124.70:8080/')], contextPath: null, war: 'target/*war'
          }
          else if (env.DEPLOY_ENV == 'production'){
            echo 'Deploying to production tomcat'
          }
        }
      }
    }
  }
}
